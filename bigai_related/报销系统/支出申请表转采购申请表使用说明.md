# 支出申请表转采购申请表使用说明

本工具可以将通过 `expense_request.py` 生成的支出申请表（报销表）转换为标准的采购申请表格式。

## 🎯 功能概述

将支出申请表中的32条报销记录转换为采购申请表，包括：
- 智本信息（申请日期、申请人、部门）
- 采购明细（序号、采购类型、物品名称、规格型号等）
- 合计金额和审批信息

## 📋 转换逻辑

### 数据映射关系

| 支出申请表字段 | 采购申请表字段 | 转换逻辑 |
|----------------|----------------|----------|
| 付款明细原因 | 物品名称 | 直接映射 |
| 金额 | 单价(元) | 直接映射 |
| 金额 | 金额(元) | 直接映射 |
| 项目负责人 | 申请人 | 直接映射 |
| 发票号码 | 备注 | 添加到备注字段 |

### 智能分类

1. **采购类型判断**：
   - 设备相关 → `科研设备`
   - 耗材相关 → `耗材用品`
   - 软件相关 → `软件许可`
   - 办公相关 → `办公设备`
   - 默认 → `科研设备`

2. **二级分类判断**：
   - 螺丝、轴承、胶带等 → `科研耗材`
   - 纸、笔、文件夹等 → `办公用品`
   - 充电器、电机等 → `设备采购`
   - 默认 → `科研耗材`

3. **单位判断**：
   - 螺丝、轴承 → `个`
   - 线、缆 → `米`
   - 胶带 → `卷`
   - 设备、充电器 → `台`
   - 砝码 → `套`
   - 推车 → `辆`
   - 默认 → `个`

4. **数量估算**（大额物品）：
   - 螺丝类：50-100个
   - 轴承类：10个
   - 胶带类：5卷
   - 连接器类：5个
   - 默认：1个

## 🛠️ 使用方法

### 基本使用

```bash
# 使用默认文件（自动检测）
python simple_expense_to_procurement.py

# 指定支出申请表文件
python simple_expense_to_procurement.py "/path/to/expense_report.xlsx"

# 指定输出文件
python simple_expense_to_procurement.py "/path/to/expense_report.xlsx" -o "/path/to/output.xlsx"
```

### 命令行参数

```bash
python simple_expense_to_procurement.py [支出申请表路径] [-o 输出路径]

# 参数说明：
# 支出申请表路径：必需，支出申请表的Excel文件路径
# -o, --output：可选，输出采购申请表的文件路径，不指定则自动生成
```

### 输出文件命名

如果不指定输出文件名，会自动生成：
- 格式：`YYYYMMDD_HHMMSS_采购申请_原文件名.xlsx`
- 示例：`20251104_203458_采购申请_20251104_报销.xlsx`

## 📊 转换示例

### 输入文件（支出申请表）

| 付款明细原因 | 项目负责人 | 发票类型 | 发票号码 | 付款类型 | 科目明细 | 金额 |
|-------------|-----------|-----------|-----------|-----------|-----------|------|
| 热熔胶 | 马晓健 | 增值税电子普通发票 | 25372000000243991216 | 科研费用 | 科研耗材 | 28.80 |
| 砝码 | 马晓健 | 增值税电子普通发票 | 25352000000115336559 | 科研费用 | 科研耗材 | 106.17 |
| ... | ... | ... | ... | ... | ... | ... |

### 输出文件（采购申请表）

```
采购申请表

申请日期: 2025-11-04
申请人: 马晓健
部门: 人工智能研究院

序号 | 采购类型 | 物品名称 | 规格型号 | 单位 | 数量 | 单价(元) | 金额(元) | 二级分类 | 备注
-----|---------|---------|---------|-----|-----|----------|----------|----------|------------------------------------
1    | 耗材用品 | 热熔胶 | 热熔胶   | 个   | 1    | 28.80     | 28.80     | 科研耗材 | 来源：支出申请表，发票号码：25372000000243991216
2    | 科研设备 | 砝码     | 砝码     | 套   | 1    | 106.17    | 106.17    | 科研耗材 | 来源：支出申请表，发票号码：25352000000115336559
...  | ...      | ...      | ...     | ... | ... | ...      | ...      | ...      | ...
32   | 科研设备 | 滚针轴承 | 滚针轴承 | 个   | 1    | 10.09     | 10.09     | 科研耗材 | 来源：支出申请表，发票号码：25332000000405984695

合计金额                                                               2615.87

申请人签字:                                                    部门负责人:                                                    财务审核:
日期:                                                                 | 日期:                                                               | 日期:
```

## ✅ 转换结果统计

- **处理记录数**: 32条
- **总金额**: 2,615.87元
- **生成文件**: `20251104_203458_采购申请_20251104_报销.xlsx`
- **文件大小**: 约7-8KB

## 🔧 脚本特性

### 优势
- ✅ **完全自动化**：一键转换，无需手动调整
- ✅ **智能分类**：根据物品名称自动分类
- ✅ **保留原始信息**：发票号码等原始信息保留在备注中
- ✅ **格式标准**：生成标准的采购申请表格式
- ✅ **错误处理**：完善的错误处理和日志记录

### 支持的输入格式
- ✅ 通过 `expense_request.py` 生成的Excel文件
- ✅ 包含表头的标准支出申请表
- ✅ 必需字段：`付款明细原因`、`金额`
- ✅ 可选字段：`发票号码`、`发票类型`、`项目负责人`

### 智能化功能
- 🤖 **智能分类**：自动判断采购类型和二级分类
- 🧮 **智能单位**：根据物品名称自动确定单位
- 📊 **数量估算**：大额物品自动估算合理数量
- 📝 **信息保留**：原始发票信息完整保留

## 🚨 注意事项

1. **文件格式**：只支持Excel格式的支出申请表
2. **表头要求**：必须包含"付款明细原因"和"金额"列
3. **数据验证**：跳过空行和无效数据行
4. **金额处理**：自动处理千分位分隔符（如"1,000"）

## 📞 故障排除

### 常见问题

1. **"未找到表头行"错误**
   - 检查Excel文件是否包含"付款明细原因"列
   - 确保文件格式正确

2. **"支出申请表中没有有效数据"错误**
   - 检查文件是否有数据行
   - 确保数据行包含付款明细原因和金额

3. **转换结果异常**
   - 查看日志输出了解详细错误信息
   - 检查输入文件格式是否正确

4. **文件权限问题**
   - 确保对文件有读取权限
   - 确保输出目录有写入权限

## 💡 使用建议

### 最佳实践

1. **先备份原文件**：转换前备份原始支出申请表
2. **验证输出文件**：转换后检查生成的采购申请表
3. **手动检查**：重要信息建议手动核实
4. **定期使用**：可以批量处理多个支出申请表

### 集成到工作流

```bash
# 1. 运行支出申请表转换
python simple_expense_to_procurement.py "/path/to/expense_reports.xlsx"

# 2. 检查生成的文件
ls -la "*采购申请*"

# 3. 根据需要进行后续调整
```

---

**🎯 核心价值**：将报销记录转换为采购申请格式，实现数据格式的无缝转换，提高文档处理效率。